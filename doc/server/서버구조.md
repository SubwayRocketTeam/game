½ºÄÉÁÙ·¯

NewSchedulerEvent
cp

init {
	NewSchedulerEvent = CreateEvent(NULL, TRUE, FALSE, NULL);

	...loop...

	CloseHandle(NewSchedulerEvent);
}

MakeRoomHandler {
	id = GameRoomManager::getInstance()->createRoom();
	Schduler::getInstance()->schedule(id);
}

Scheduler::init {
	std::thread(&idToSchedule).detach();
}

Scheduler::schedule(room_id) {
	idToSchedule = room_id;
	ResetEvent(NewSchedulerEvent);
}

½ºÄÉÁÙ ½º·¹µå(*room_id) {
	WaitForSingleObjectEx(NewScheduleEvent);
	timer = CreateWaitableTimer();
	SetWaitableTimer(timer, 16, ¿Ï·á·çÆ¾, [timer, *room_id]);
}

¿Ï·á ·çÆ¾ ([timer, room_id]) {
	TimerContext context(room_id);
	if (GameRoomManager::getInstance()->getGameRoom(room_id)) {
		PostQueuedCompleteStatus(cp, TIMER, &context);
		SetWaitableTimer(timer, 16, ¿Ï·á·çÆ¾, [timer, room_id]);
	}
	else {
		CloseHandle(timer);
	}
}


----------------------------------- ÀÌÇÏ °ú°Å -----------------------------------------
ºÛ¾î¾î¾î¾î¾î¾îºŞ¿¡¿¡¿¡¿¡¿¡ºÎ¾Æ¾Æ¾Æ¾Æ¾Æ¾Ó¬u¬u¬r¬r«‡«‡­h­h
Å¬¶ó¿¡¼­ ¼­¹ö·Î ÆĞÅ¶À» º¸³»¸é
¼­¹ö´Â ¿öÄ¿°¡ ÆĞÅ¶À» ¹Ş¾Æ¼­ ÆĞÅ¶À» Ã³¸®ÇÑ´Ù.
¸ŞÀÎ ½º·¹µå´Â accept¸¸ ÇÑ´Ù.
acceptÇÏ¸é acceptµÈ ¼ÒÄÏÀ¸·Î Client°¡ »ı¼ºµÈ´Ù.
Client´Â ClientManager¿¡¼­ °ü¸®ÇÑ´Ù.
¿öÄ¿ ½º·¹µå´Â ÆĞÅ¶À» ¹Ş¾Æ Client¸¶´Ù Å¥À×ÇÑ´Ù.
Client´Â Å¥¸¦ º¸°í ÆĞÅ¶ÀÌ ¿Ï¼ºµÇ¾úÀ¸¸é ±× ÆĞÅ¶À» »©¼­ Ã³¸®ÇÑ´Ù.
Ã³¸®°¡ ³¡³ª¸é ´äÆĞÅ¶À» º¸³½´Ù.
°ÔÀÓ ·ÎÁ÷ ½º·¹µå´Â ÁÖ±âÀûÀ¸·Î °ÔÀÓ ·ÎÁ÷À» µ¹¸°´Ù. ÇÑ ½º·¹µå¿¡¼­ ¿©·¯ °ÔÀÓÀ» µ¹¸± ¼öµµ ÀÖ´Ù.
°ÔÀÓÀº GameRoom ÇüÅÂ. GameRoomManager°¡ °ü¸®ÇÑ´Ù.
GameRoom¸¶´Ù Å¬¶óÀÇ Àü¿ª ½Ì±ÛÅæ °´Ã¼¿´´ø °Ô ´Ù ¸â¹ö·Î µé¾î°¡ÀÖ´Ù.
°ÔÀÓ ¿ÀºêÁ§Æ®µéÀº ÀÚ±â GameRoomÀ» ¾Ë°í ÀÖ¾î¼­ ¹Ù·Î¹Ù·Î Á¢±ÙÇÒ ¼ö ÀÖ´Ù.
Client´Â Á¢¼ÓÇÏ°í °ÔÀÓ µé¾î°¡¸é GameRoomÀ» ÇÒ´ç¹Ş´Â´Ù.
GameRoomµµ ÀÚ½Å°ú ¿¬°áµÈ Client¸¦ °¡Áø´Ù.
GameRoom¸¶´Ù ID¹ß±Ş±â¸¦ °¡Áø´Ù. °´Ã¼°¡ »ı¼ºµÇ¸é ID ¹ß±Ş±â°¡ ID¸¦ ¸¸µé¾îÁØ´Ù.
GameRoomÀº »ı¼ºµÇ¸é update¸¦ À§ÇØ Scheduler¿¡ µî·ÏµÈ´Ù.
Scheduler´Â ½Ì±ÛÅæ °´Ã¼. SchedulableÀ» »ó¼Ó¹Ş´Â °´Ã¼µéÀ» µî·Ï¹Ş´Â´Ù. ½ºÄÉÁÙ µÇ´Â ÁÖ±â¸¦ ¼³Á¤ °¡´ÉÇÏ´Ù.
DB ½º·¹µå´Â DB¸¦ µ¹¸°´Ù. ºù±Ûºù±Û.
DB Äõ¸® °´Ã¼´Â Äõ¸® Á¾·ù¿Í ³»¿ëÀ» °¡Áö°í ¿äÃ»ÇÑ clientÀÇ id¸¦ °¡Áø´Ù.
DB ÀÛ¾÷Àº µ¿±â. ¿öÄ¿ ½º·¹µå¿¡¼­ DB ¿äÃ»Àº ºñµ¿±â.
¼¼Å¹±â´Â »¡·¡¸¦ µ¹¸°´Ù. ºù±Ûºù±Û.

main {
	socket »ı¼º
	CP »ı¼º(¿öÄ¿¿ë, DB¿ë)
	listen()
	½º·¹µå »ı¼º(accept, ¿öÄ¿, DB, ·ÎÁ÷(½ºÄÉÁÙ))
}

accept ½º·¹µå {
	accept()
	ClientManager.createClient()
}

¿öÄ¿ ½º·¹µå {
	GQCS()
	overlapped¿¡ Client°¡ µş·Á¿Â´Ù.
	if(send)
		¹«½Ã
	if(recv) {
		client¿¡°Ô ³Ö¾îÁØ´Ù.
		client.ÆĞÅ¶Ã³¸®()
	}
}

DB ½º·¹µå {
	GQCS()
	overlappeed¿¡ DB Äõ¸®°¡ µş·Á¿Â´Ù.
	DBÀÛ¾÷ÇÑ´Ù. ºí·ÎÅ·µÊ.
	ÇÊ¿äÇÑ °æ¿ì ¿äÃ»ÇÑ Å¬¶ó¿¡°Ô ´äÀåÀ» º¸³½´Ù.
}

·ÎÁ÷ ½º·¹µå {
	timegettime()
	for ÀÚ½ÅÀÌ °¡Áø GameRoomµé
		if ¾÷µ¥ÀÌÆ® ÇÒ ½Ã°£
			GameRoom.update()
}